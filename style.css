body {
	font-family: 'Roboto', sans-serif;
	margin: 20px;
	background: #f0f0f0;
	color: #333;
	transition: background 0.5s ease-in-out; /* Smoother transition for body */
	line-height: 1.6;
}

h1 {
	font-family: 'Merriweather', serif;
	text-align: center;
	font-weight: bold;
	margin-bottom: 20px;
	color: #333; /* Black color for light theme */
}
body.dark h1 {
	color: #fff; /* White color for dark theme */
}

textarea {
	font-family: 'Roboto', monospace; /* Monospace font for textarea */
	border: 1px solid #ccc;
	border-radius: 8px; /* Rounded corners for textarea */
	padding: 10px; /* Padding inside textarea */
	box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1); /* More pronounced inner shadow */
}
body.dark {
	background: #222;
	color: #ddd;
	transition: background 0.5s ease-in-out; /* Smoother transition for dark mode */
}
h1 {
	text-align: center;
}
textarea {
	width: 100%;
	height: 200px;
	padding: 10px;
	font-size: 14px;
	box-sizing: border-box;
	border: 1px solid #ccc;
	border-radius: 4px;
	resize: vertical;
	background: #fff;
	color: #333;
}
body.dark textarea,
body.dark #preview {
	border-color: #555;
	background-color: #333;
	color: #ddd;
	font-family: 'Times New Roman', Times, serif;
}
#preview {
	margin-top: 20px;
	padding: 20px; /* More padding for preview */
	border: 1px solid #ddd; /* Lighter border for preview */
	background: #fff;
	border-radius: 8px; /* Rounded corners for preview */
	min-height: 100px;
	font-family: 'Times New Roman', Times, serif; /* Set font for preview */
	box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for preview */
}
body.dark #preview {
	background: #333;
	border: 1px solid #555;
}
button {
	margin-top: 10px;
	padding: 12px 20px; /* Increased padding */
	font-size: 16px; /* Increased font size */
	border: none;
	border-radius: 8px; /* More rounded corners */
	background: #007bff;
	color: #fff;
	cursor: pointer;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow */
	transition: background-color 0.3s ease; /* Smooth background transition */
}
button:hover {
	background: #0056b3;
}
button:active {
	background: #004289; /* Even darker shade for active state */
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); /* Slightly adjusted shadow when active */
}
#themeToggle {
	position: fixed;
	top: 20px;
	right: 20px;
	padding: 10px 15px;
	font-size: 14px;
	border: none;
	border-radius: 8px;
	background: #6c757d; /* Grey background for toggle */
	color: #fff;
	cursor: pointer;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	transition: background-color 0.3s ease;
}
#themeToggle:hover {
	background: #5a6268; /* Darker grey on hover */
}
#themeToggle:active {
	background: #4e555b; /* Even darker grey on active */
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
}
#historyControls {
	margin-top: 20px; /* More margin above history controls */
	text-align: center; /* Center align history buttons */
}
#historyControls button {
	margin: 0 5px; /* Spacing between history buttons */
	padding: 8px 12px; /* Slightly smaller padding for history buttons */
	font-size: 14px; /* Slightly smaller font size for history buttons */
	background: #eee; /* Lighter background for history buttons */
	color: #555; /* Darker text color for history buttons */
	border-radius: 6px; /* Slightly less rounded corners for history buttons */
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* Smaller shadow for history buttons */
	transition: background-color 0.3s ease, color 0.3s ease;
}
#historyControls button:hover {
	background: #ddd; /* Slightly darker background on hover for history buttons */
	color: #333; /* Darker text on hover for history buttons */
}
#historyControls button:active {
	background: #ccc; /* Even darker background on active for history buttons */
	box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15); /* Even smaller shadow when active for history buttons */
}
/* Кнопка, которая появляется при выделении текста в preview */
#contextAction {
	position: absolute;
	display: none;
	padding: 5px 10px;
	font-size: 12px;
	background: #28a745;
	color: #fff;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	z-index: 1000;
}

/* Стили для блока настроек */
#formattingOptions {
	margin-top: 15px;
	padding: 10px; /* Уменьшим общий padding */
	border: 1px solid #ccc;
	border-radius: 8px;
	background-color: #f9f9f9;
	display: flex; /* Включаем Flexbox */
	flex-wrap: wrap; /* Позволяем группам переноситься */
	gap: 10px; /* Пространство между группами */
	justify-content: space-around; /* Распределение групп */
}

body.dark #formattingOptions {
	border-color: #555;
	background-color: #3a3a3a;
}

#formattingOptions legend {
	font-weight: bold;
	padding: 0 10px;
	color: #333;
	width: 100%; /* Заголовок на всю ширину перед группами */
	margin-bottom: 10px; /* Отступ после заголовка */
	text-align: center; /* Центрируем легенду */
}

body.dark #formattingOptions legend {
	color: #ddd;
}

#formattingOptions div {
	margin-bottom: 10px; /* Отступ между строками настроек */
	display: flex; /* Выравнивание label и input/select */
	align-items: center; /* Вертикальное выравнивание по центру */
}

#formattingOptions label {
	margin-left: 8px; /* Отступ между чекбоксом/селектом и текстом */
	flex-grow: 1; /* Занимает оставшееся место */
	color: #333; /* Цвет текста в светлой теме */
}

body.dark #formattingOptions label {
	color: #ddd; /* Цвет текста в темной теме */
}

#formattingOptions input[type='checkbox'] {
	margin: 0; /* Убираем лишние отступы у чекбоксов */
	width: 16px; /* Фиксированная ширина чекбокса */
	height: 16px; /* Фиксированная высота чекбокса */
	cursor: pointer;
}

#formattingOptions select {
	padding: 5px 8px;
	border: 1px solid #ccc;
	border-radius: 4px;
	background: #fff;
	color: #333;
	margin-left: 5px; /* Небольшой отступ слева */
	cursor: pointer;
}

#formattingOptions select#lineHeightType {
	/* Стили как у других select */
	padding: 5px 8px;
	border: 1px solid #ccc;
	border-radius: 4px;
	background: #fff;
	color: #333;
	cursor: pointer;
	margin-left: 5px;
	margin-right: 5px;
}
body.dark #formattingOptions select#lineHeightType {
	border-color: #555;
	background-color: #333;
	color: #ddd;
}

#formattingOptions input#lineHeightValue {
	/* Стили как у других number input */
	width: 60px;
	padding: 4px 6px;
	border: 1px solid #ccc;
	border-radius: 4px;
}
body.dark #formattingOptions input#lineHeightValue {
	border-color: #555;
	background-color: #333;
	color: #ddd;
}

#formattingOptions span#lineHeightUnit {
	margin-left: 3px;
	font-size: 0.9em;
	color: #555;
}
body.dark #formattingOptions span#lineHeightUnit {
	color: #bbb;
}

body.dark #formattingOptions select {
	border-color: #555;
	background-color: #333;
	color: #ddd;
}

/* Класс для отключения стиля кода */
#preview.no-code-style code {
	font-family: inherit !important; /* Наследовать шрифт от родителя */
	font-size: inherit !important; /* Наследовать размер шрифта */
	background-color: transparent !important; /* Убрать фон */
	border: none !important; /* Убрать рамку (если есть) */
	padding: 0 !important; /* Убрать отступы */
	color: inherit !important; /* Наследовать цвет текста */
	/* Добавьте !important, если стили marked.js или браузера перебивают */
}

/* Класс для подавления отступов --- */
#preview.no-indentation p,
#preview.no-indentation blockquote,
#preview.no-indentation div {
	/* Захватываем общие блочные элементы */
	margin-left: 0 !important;
	padding-left: 0 !important;
	text-indent: 0 !important;
}

#preview.no-indentation ul,
#preview.no-indentation ol {
	margin-left: 0 !important; /* Убираем внешний отступ списка */
	padding-left: 1.5em !important; /* Оставляем небольшой внутренний отступ для маркеров */
	text-indent: 0 !important;
}

#preview.no-indentation li {
	margin-left: 0 !important; /* Убираем отступ самого элемента списка */
	padding-left: 0 !important;
	text-indent: 0 !important;
}

#preview.no-indentation pre {
	margin-left: 0 !important; /* Убираем отступ у блоков кода */
	padding-left: 5px !important; /* Оставляем минимальный padding для читаемости */
	text-indent: 0 !important;
}

/* Класс для отключения стиля кода */
#preview.no-code-style code {
	/*...*/
}

/* Класс для подавления отступов */
#preview.no-indentation p, /*...*/
#preview.no-indentation ul, /*...*/
#preview.no-indentation li, /*...*/
#preview.no-indentation pre {
	/*...*/
}

/* --- НОВОЕ: Класс для выравнивания по ширине --- */
#preview.force-justify {
	text-align: justify !important;
}
/* Чтобы выравнивание по ширине не ломало центрирование заголовков */
#preview.force-justify h1,
#preview.force-justify h2,
#preview.force-justify h3,
#preview.force-justify h4,
#preview.force-justify h5,
#preview.force-justify h6 {
	text-align: left; /* Или center, если нужно оставить заголовки по центру */
}

/* Стили по умолчанию (без рамок, но с отступами) */
#preview table {
	border-collapse: collapse; /* Важно для корректных рамок */
	width: auto; /* Или 100% если нужно по ширине */
	margin-top: 1em;
	margin-bottom: 1em;
	border: none; /* По умолчанию нет */
}
#preview th,
#preview td {
	padding: 8px 12px;
	border: none; /* По умолчанию нет */
	text-align: left;
}
#preview th {
	font-weight: bold;
	background-color: #f0f0f0; /* Легкий фон для шапки */
}
body.dark #preview th {
	background-color: #3a3a3a;
}

/* Стиль: Все рамки */
#preview.table-border-all table,
#preview.table-border-all th,
#preview.table-border-all td {
	border: 1px solid #ccc;
}
body.dark #preview.table-border-all table,
body.dark #preview.table-border-all th,
body.dark #preview.table-border-all td {
	border-color: #666;
}

/* Стиль: Только внешние рамки */
#preview.table-border-outer table {
	border: 1px solid #ccc;
}
#preview.table-border-outer th,
#preview.table-border-outer td {
	border: none; /* Убираем внутренние рамки */
}
body.dark #preview.table-border-outer table {
	border-color: #666;
}

/* Стиль: Шапка + внешние */
#preview.table-border-header table {
	border: 1px solid #ccc; /* Внешняя рамка таблицы */
}
#preview.table-border-header th {
	border-bottom: 1px solid #ccc; /* Линия под шапкой */
	border-left: none; /* Убираем боковые рамки у ячеек шапки */
	border-right: none;
	border-top: none;
}
#preview.table-border-header td {
	border: none; /* Убираем рамки у обычных ячеек */
}
body.dark #preview.table-border-header table,
body.dark #preview.table-border-header th {
	border-color: #666;
}

/* Убираем рамки, если выбрано "Нет рамок" (на всякий случай) */
#preview.table-border-none table,
#preview.table-border-none th,
#preview.table-border-none td {
	border: none !important;
}

/* Применяется к label внутри div, который содержит select */
#formattingOptions div:has(select) label {
	flex-grow: 0;
	margin-right: 10px;
	/* Добавим немного гибкости для узких экранов, если текст длинный */
	/* flex-shrink: 1; */ /* Можно раскомментировать, если нужно сжатие */
}
/* Применяется к select внутри div, который содержит select */
#formattingOptions div:has(select) select,
#formattingOptions div:has(input[list]) input {
	/* И для input с datalist */
	flex-grow: 1; /* Позволим селекту/инпуту занять место */
	min-width: 100px; /* Минимальная ширина для читаемости */
}
#resetFontBtn {
	flex-shrink: 0; /* Кнопка сброса не должна сжиматься */
}

#formattingOptions .option-group {
	border: 1px solid #e0e0e0;
	border-radius: 6px;
	padding: 10px 15px; /* Вернул нормальный padding */
	/* Убираем margin-bottom, так как gap теперь управляет отступом */
	background-color: #fff;
	flex-grow: 1; /* Позволяем группам расти */
	flex-basis: 280px; /* Минимальная ширина группы перед переносом */
	min-width: 250px; /* Абсолютный минимум для узких экранов */
	box-sizing: border-box; /* Учитываем padding и border в ширине */
	flex-direction: column;
}
body.dark #formattingOptions .option-group {
	border-color: #444;
	background-color: #303030;
}
#formattingOptions .option-group-title {
	font-weight: bold;
	margin-bottom: 10px;
	color: #555;
	font-size: 0.95em;
}
body.dark #formattingOptions .option-group-title {
	color: #bbb;
}
#formattingOptions .option-group > div {
	/* Стили для строк внутри группы */
	margin-bottom: 8px; /* Уменьшил отступ между строками */
	display: flex;
	align-items: center;
}

/* Стили для полей ввода number */
#formattingOptions input[type='number'] {
	width: 60px; /* Фиксированная ширина */
	padding: 4px 6px;
	border: 1px solid #ccc;
	border-radius: 4px;
	margin-left: 5px;
}
body.dark #formattingOptions input[type='number'] {
	border-color: #555;
	background-color: #333;
	color: #ddd;
}

/* Стили для выбора шрифта */
#formattingOptions input#fontSelector {
	flex-grow: 1; /* Позволяем полю ввода растягиваться */
	margin-left: 5px;
	margin-right: 5px; /* Отступ перед кнопкой сброса */
	padding: 4px 6px;
	border: 1px solid #ccc;
	border-radius: 4px;
}
body.dark #formattingOptions input#fontSelector {
	border-color: #555;
	background-color: #333;
	color: #ddd;
}
#resetFontBtn {
	padding: 4px 8px;
	font-size: 14px;
	min-width: auto; /* Убираем минимальную ширину кнопки */
	margin-left: 0; /* Убираем лишний отступ */
	margin-top: 0; /* Убираем лишний отступ */
	line-height: 1; /* Выравнивание символа */
	background-color: #eee;
	color: #333;
	border: 1px solid #ccc;
}
#resetFontBtn:hover {
	background-color: #ddd;
}
body.dark #resetFontBtn {
	background-color: #444;
	color: #ddd;
	border-color: #666;
}
body.dark #resetFontBtn:hover {
	background-color: #555;
}

/* --- CSS Переменные и классы для интервалов и ссылок --- */
:root {
	/* Определяем переменные в корне */
	--paragraph-spacing-before: 0pt; /* Значения по умолчанию */
	--paragraph-spacing-after: 8pt;
	--line-height-multiplier: 1.15;
}

#preview {
	/* Применяем стили по умолчанию через переменные или напрямую */
	font-family: 'Times New Roman', Times, serif; /* Шрифт по умолчанию */
	line-height: var(--line-height-multiplier); /* Междустрочный интервал */
	/* Отступы будут применяться к p и li ниже */
}

#preview p,
#preview ul,
#preview ol,
#preview blockquote {
	/* Применяем отступы к основным блокам */
	margin-top: var(--paragraph-spacing-before);
	margin-bottom: var(--paragraph-spacing-after);
}
#preview li > p {
	/* Убираем лишние отступы у параграфов внутри li */
	margin-top: 0;
	margin-bottom: 0;
}

/* Класс для скрытия подчеркивания ссылок */
#preview.no-link-underline a {
	text-decoration: none !important;
}

#formattingOptions select #fontSelector {
	flex-grow: 1; /* Позволяем селекту растягиваться */
	margin-left: 5px;
	margin-right: 5px;
	padding: 5px 8px; /* Стандартный padding для select */
	border: 1px solid #ccc;
	border-radius: 4px;
	background: #fff;
	color: #333;
	cursor: pointer;
	min-width: 120px; /* Немного больше для селекта */
}
body.dark #formattingOptions select #fontSelector {
	border-color: #555;
	background-color: #333;
	color: #ddd;
}

#formattingOptions div:has(select) select {
	flex-grow: 1; /* Переопределяем, если нужно */
	min-width: 100px;
	margin-left: 0; /* Сбрасываем отступ слева */
}
